# üí∞ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è Next.js (–¥–µ—à—ë–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Å–µ—Ä–≤–µ—Ä—É

**–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- CPU: 1 —è–¥—Ä–æ
- RAM: 1GB (–º–∏–Ω–∏–º—É–º) / 2GB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- –î–∏—Å–∫: 20GB SSD
- –û–°: Ubuntu 22.04 LTS

**–°—Ç–æ–∏–º–æ—Å—Ç—å:** –ø—Ä–∏–º–µ—Ä–Ω–æ 200-300‚ÇΩ/–º–µ—Å—è—Ü (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞)

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞ –≤ reg.ru

1. –ó–∞–π–¥–∏—Ç–µ –Ω–∞ https://www.reg.ru
2. VPS ‚Üí –ó–∞–∫–∞–∑–∞—Ç—å –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä
3. –í—ã–±–µ—Ä–∏—Ç–µ:
   - **–û–°:** Ubuntu 22.04 LTS
   - **CPU:** 1 —è–¥—Ä–æ
   - **RAM:** 2GB (–º–∏–Ω–∏–º—É–º 1GB, –Ω–æ –ª—É—á—à–µ 2GB)
   - **–î–∏—Å–∫:** 20GB SSD
   - **–°–µ—Ç—å:** 1TB —Ç—Ä–∞—Ñ–∏–∫–∞
4. **–í–∞–∂–Ω–æ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏:**
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **–°–ò–õ–¨–ù–´–ô –ø–∞—Ä–æ–ª—å** (–º–∏–Ω–∏–º—É–º 20 —Å–∏–º–≤–æ–ª–æ–≤)
   - –ò–ª–∏ –ª—É—á—à–µ: –∑–∞–≥—Ä—É–∑–∏—Ç–µ SSH –∫–ª—é—á (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)

### –®–∞–≥ 2: –ü–µ—Ä–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@–í–ê–®_IP_–ê–î–†–ï–°

# –°—Ä–∞–∑—É –æ–±–Ω–æ–≤–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É
apt update && apt upgrade -y

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
# reboot
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!)

```bash
# 1. –°–†–ê–ó–£ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –≤—Ö–æ–¥–∞ –æ–±–Ω–æ–≤–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É
apt update && apt upgrade -y

# 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ firewall –∏ fail2ban
apt install -y ufw fail2ban

# 3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ firewall (–ó–ê–ö–†–û–ô–¢–ï –í–°–Å –ö–†–û–ú–ï –ù–£–ñ–ù–û–ì–û!)
ufw default deny incoming
ufw default allow outgoing
ufw allow ssh      # SSH –ø–æ—Ä—Ç (–ø–æ–∫–∞ –æ—Å—Ç–∞–≤–ª—è–µ–º)
ufw allow 80/tcp   # HTTP
ufw allow 443/tcp  # HTTPS
ufw --force enable
ufw status

# 4. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç SSH (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—Ç, –Ω–∞–ø—Ä–∏–º–µ—Ä 23456)
nano /etc/ssh/sshd_config

# –ù–∞–π–¥–∏—Ç–µ –∏ –∏–∑–º–µ–Ω–∏—Ç–µ:
# Port 22  ‚Üí  Port 23456 (–∏–ª–∏ –¥—Ä—É–≥–æ–π —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—Ç)
# #PermitRootLogin yes  ‚Üí  PermitRootLogin prohibit-password
# PasswordAuthentication yes  ‚Üí  PasswordAuthentication no (–ü–û–°–õ–ï –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SSH –∫–ª—é—á–µ–π!)
# PubkeyAuthentication yes  ‚Üí  —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —ç—Ç–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ

# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ: Ctrl+O, Enter, Ctrl+X
systemctl restart sshd

# 5. –û–±–Ω–æ–≤–∏—Ç–µ firewall –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø–æ—Ä—Ç–∞ SSH
ufw allow 23456/tcp
ufw delete allow ssh
ufw status

# 6. –ù–ê–°–¢–†–û–ô–¢–ï SSH –ö–õ–Æ–ß–ò (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û! –ë–µ–∑ —ç—Ç–æ–≥–æ –±—É–¥–µ—Ç –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
# –ù–∞ –≤–∞—à–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ (Windows):
# ssh-keygen -t ed25519 -C "your_email@example.com"
# —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ ~/.ssh/id_ed25519.pub

# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ —Å–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ —Ñ–∞–π–ª:
mkdir -p ~/.ssh
chmod 700 ~/.ssh
nano ~/.ssh/authorized_keys
# –í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (–æ–¥–Ω–∞ —Å—Ç—Ä–æ–∫–∞)
chmod 600 ~/.ssh/authorized_keys

# –¢–µ–ø–µ—Ä—å –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —Å –∫–ª—é—á–æ–º:
# ssh -p 23456 -i ~/.ssh/id_ed25519 root@–í–ê–®_IP

# –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —Å –∫–ª—é—á–æ–º –æ—Ç–∫–ª—é—á–∏—Ç–µ –ø–∞—Ä–æ–ª–∏:
nano /etc/ssh/sshd_config
# PasswordAuthentication no
systemctl restart sshd

# 7. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ fail2ban (–ê–ì–†–ï–°–°–ò–í–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò!)
cat > /etc/fail2ban/jail.local << 'EOF'
[DEFAULT]
bantime = 86400
findtime = 300
maxretry = 3
destemail = root@localhost
sendername = Fail2Ban
action = %(action_)s

[sshd]
enabled = true
port = 23456
filter = sshd
logpath = %(sshd_log)s
backend = %(sshd_backend)s
maxretry = 3
bantime = 86400
findtime = 300
EOF

systemctl restart fail2ban
fail2ban-client status sshd

# 8. –û–ì–†–ê–ù–ò–ß–¨–¢–ï –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–Ø –ö SSH (—Ç–æ–ª—å–∫–æ —Å –≤–∞—à–µ–≥–æ IP)
# –£–∑–Ω–∞–π—Ç–µ —Å–≤–æ–π IP: https://whatismyipaddress.com
# –ó–∞–º–µ–Ω–∏—Ç–µ YOUR_IP –Ω–∞ –≤–∞—à IP –∞–¥—Ä–µ—Å:
ufw delete allow 23456/tcp
ufw allow from YOUR_IP to any port 23456 proto tcp

# 9. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É –∂—É—Ä–Ω–∞–ª–æ–≤ (—á—Ç–æ–±—ã –Ω–µ –∑–∞—Å–æ—Ä—è–ª–∏ –¥–∏—Å–∫)
cat > /etc/systemd/journald.conf << 'EOF'
[Journal]
SystemMaxUse=100M
SystemKeepFree=500M
MaxRetentionSec=7day
EOF

systemctl restart systemd-journald

# 10. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
cat > /root/check-security.sh << 'EOF'
#!/bin/bash
LOG_FILE="/var/log/security-check.log"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
SUSPICIOUS=$(ps aux | grep -E "(miner|crypto|xmrig|stratum|monero|bitcoin)" | grep -v grep)
if [ -n "$SUSPICIOUS" ]; then
    echo "[$(date)] –í–ù–ò–ú–ê–ù–ò–ï: –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã:" >> "$LOG_FILE"
    echo "$SUSPICIOUS" >> "$LOG_FILE"
    # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É email –∏–ª–∏ –¥—Ä—É–≥–∏–µ –¥–µ–π—Å—Ç–≤–∏—è
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ–æ–±—ã—á–Ω–æ –≤—ã—Å–æ–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É CPU
HIGH_CPU=$(ps aux --sort=-%cpu | head -n 5 | awk 'NR>1 && $3>50 {print $0}')
if [ -n "$HIGH_CPU" ]; then
    echo "[$(date)] –í–ù–ò–ú–ê–ù–ò–ï: –í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ CPU:" >> "$LOG_FILE"
    echo "$HIGH_CPU" >> "$LOG_FILE"
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
UNKNOWN_CRON=$(crontab -l 2>/dev/null | grep -v "^#" | grep -v "^$")
if [ -n "$UNKNOWN_CRON" ]; then
    echo "[$(date)] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cron –∑–∞–¥–∞—á–∏:" >> "$LOG_FILE"
    echo "$UNKNOWN_CRON" >> "$LOG_FILE"
fi
EOF

chmod +x /root/check-security.sh

# –î–æ–±–∞–≤—å—Ç–µ –≤ cron (–ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç)
(crontab -l 2>/dev/null; echo "*/10 * * * * /root/check-security.sh") | crontab -

# 11. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
echo "=== –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ ==="
echo "Firewall:"
ufw status
echo ""
echo "Fail2ban:"
fail2ban-client status sshd
echo ""
echo "SSH –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:"
grep -E "^(Port|PasswordAuthentication|PubkeyAuthentication)" /etc/ssh/sshd_config
```

### –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js (–º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Node.js 20 LTS
curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
apt install -y nodejs

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é
node -v  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å v20.x.x
npm -v

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PM2
npm install -g pm2
pm2 startup systemd -u root --hp /root
```

### –®–∞–≥ 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx

```bash
apt install -y nginx

# –°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è —Å–∞–π—Ç–∞
cat > /etc/nginx/sites-available/tashi-ani << 'EOF'
server {
    listen 80;
    server_name tashi-ani.ru www.tashi-ani.ru;

    access_log /var/log/nginx/tashi-ani-access.log;
    error_log /var/log/nginx/tashi-ani-error.log;

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }
}
EOF

# –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
ln -s /etc/nginx/sites-available/tashi-ani /etc/nginx/sites-enabled/
rm -f /etc/nginx/sites-enabled/default

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
nginx -t

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ Nginx
systemctl enable nginx
systemctl restart nginx
```

### –®–∞–≥ 6: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd /var/www

# 2. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ –ø—Ä–æ–µ–∫—Ç (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS –∏–ª–∏ SSH –∫–ª—é—á)
git clone https://github.com/DGersmv/tashi-ani.git
cd tashi-ani

# 3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
nano .env.local

# –í—Å—Ç–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ (–ó–ê–ú–ï–ù–ò–¢–ï –Ω–∞ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è):
DATABASE_URL="file:./prisma/prod.db"
JWT_SECRET="–ó–ê–ú–ï–ù–ò–¢–ï_–ù–ê_–°–õ–£–ß–ê–ô–ù–£–Æ_–°–¢–†–û–ö–£_–ú–ò–ù–ò–ú–£–ú_32_–°–ò–ú–í–û–õ–ê_abcdefghijklmnopqrstuvwxyz1234567890"
MASTER_ADMIN_EMAIL="admin@227.info"
MASTER_ADMIN_PASSWORD="–í–ê–®_–ü–ê–†–û–õ–¨_–ê–î–ú–ò–ù–ê"
EMAIL_USER="user@tashi-ani.ru"
EMAIL_PASS="–í–ê–®_–ü–ê–†–û–õ–¨_EMAIL"
NEXTAUTH_URL="https://tashi-ani.ru"
NODE_ENV="production"

# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ: Ctrl+O, Enter, Ctrl+X

# 4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# 5. –°–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
npx prisma generate
npx prisma migrate deploy

# 6. –°–æ–∑–¥–∞–π—Ç–µ –∞–¥–º–∏–Ω–∞
node create-admin-user.js

# 7. –°–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 3-5 –º–∏–Ω—É—Ç)
NODE_OPTIONS="--max-old-space-size=512" npm run build

# –ï—Å–ª–∏ —Å–±–æ—Ä–∫–∞ —É–±–∏–≤–∞–µ—Ç—Å—è (Killed) - —É–≤–µ–ª–∏—á—å—Ç–µ swap:
fallocate -l 1G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
echo '/swapfile none swap sw 0 0' >> /etc/fstab
free -h

# –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–±—Ä–∞—Ç—å —Å–Ω–æ–≤–∞
npm run build
```

### –®–∞–≥ 7: –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ PM2

```bash
# 1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
pm2 start ecosystem.config.js

# 2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é PM2
pm2 save

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
pm2 status
pm2 logs tashi-ani --lines 20

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
curl http://localhost:3000
```

### –®–∞–≥ 8: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ SSL (HTTPS)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Certbot
apt install -y certbot python3-certbot-nginx

# –ü–æ–ª—É—á–∏—Ç–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
certbot --nginx -d tashi-ani.ru -d www.tashi-ani.ru

# –°–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º:
# - Email: –≤–∞—à email
# - –°–æ–≥–ª–∞—Å–∏—Ç–µ—Å—å —Å —É—Å–ª–æ–≤–∏—è–º–∏ (Y)
# - Redirect HTTP to HTTPS: –≤—ã–±–µ—Ä–∏—Ç–µ 2 (Redirect)

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è
certbot certificates
```

### –®–∞–≥ 9: –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
systemctl status nginx
pm2 status
fail2ban-client status sshd

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall
ufw status

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞–º—è—Ç—å
free -h

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∞–π—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# https://tashi-ani.ru
```

## üíæ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ (–¥–ª—è 1GB RAM)

–ï—Å–ª–∏ —É –≤–∞—Å —Ç–æ–ª—å–∫–æ 1GB RAM, –¥–æ–±–∞–≤—å—Ç–µ swap:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ swap 1GB
fallocate -l 1G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
echo '/swapfile none swap sw 0 0' >> /etc/fstab

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ
free -h
```

## üîß –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏ Next.js

–ï—Å–ª–∏ —Å–±–æ—Ä–∫–∞ –ø–∞–¥–∞–µ—Ç –∏–∑-–∑–∞ –ø–∞–º—è—Ç–∏:

```bash
# –í package.json –¥–æ–±–∞–≤—å—Ç–µ –≤ scripts:
"build": "NODE_OPTIONS='--max-old-space-size=512' next build"

# –ò–ª–∏ —Å–æ–±–µ—Ä–∏—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏
watch -n 5 free -h

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
htop  # –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω: apt install htop

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pm2 logs tashi-ani
```

## ‚úÖ –ß—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å

- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä (firewall + fail2ban)
- ‚úÖ Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ HTTPS –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ PM2
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å (2GB RAM ~300‚ÇΩ/–º–µ—Å)

## üÜò –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–°–±–æ—Ä–∫–∞ –ø–∞–¥–∞–µ—Ç (Killed):** –£–≤–µ–ª–∏—á—å—Ç–µ swap (–®–∞–≥ 9)
2. **502 Bad Gateway:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `pm2 status` –∏ `pm2 logs`
3. **–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç HTTPS:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS –∑–∞–ø–∏—Å–∏ –¥–ª—è –¥–æ–º–µ–Ω–∞
4. **–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç SSH:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall: `ufw status`

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø–∏—Å–∫–æ–º

- [ ] Firewall –≤–∫–ª—é—á–µ–Ω (ufw)
- [ ] Fail2ban –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏)
- [ ] SSH –ø–æ—Ä—Ç –∏–∑–º–µ–Ω—ë–Ω (–Ω–µ 22, —Å–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—Ç)
- [ ] SSH –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –∏ –ø–∞—Ä–æ–ª–∏ –û–¢–ö–õ–Æ–ß–ï–ù–´
- [ ] SSH –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å –≤–∞—à–µ–≥–æ IP (whitelist)
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] –°–∏—Å—Ç–µ–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ (apt update && apt upgrade)
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∂—É—Ä–Ω–∞–ª–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞

## üñ•Ô∏è –í–ê–ñ–ù–û: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–∫–∞–ª—å–Ω—ã–π –∫–æ–º–ø—å—é—Ç–µ—Ä Windows!

**–ú–∞–π–Ω–µ—Ä –º–æ–≥ –ø–µ—Ä–µ–±—Ä–∞—Ç—å—Å—è —Å –≤–∞—à–µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞ —á–µ—Ä–µ–∑ SSH!**

–ü–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π –Ω–æ–≤–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Windows –∞–Ω—Ç–∏–≤–∏—Ä—É—Å–æ–º (–ø–æ–ª–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ SSH –∫–ª—é—á–∏ - –µ—Å–ª–∏ –Ω–∞—à–ª–∏ –º–∞–π–Ω–µ—Ä, —É–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –∫–ª—é—á–∏
4. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–µ SSH –∫–ª—é—á–∏

–°–º. –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é: [CHECK_LOCAL_MACHINE.md](./CHECK_LOCAL_MACHINE.md)

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –ü–æ—á–µ–º—É –º–∞–π–Ω–µ—Ä –ø—Ä–æ–Ω–∏–∫–∞–ª —Ä–∞–Ω—å—à–µ

### –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è:

1. **–ü–∞—Ä–æ–ª–∏ SSH –≤–º–µ—Å—Ç–æ –∫–ª—é—á–µ–π** - –±—Ä—É—Ç—Ñ–æ—Ä—Å –∞—Ç–∞–∫–∏
2. **–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç SSH (22)** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∫–∞–Ω–µ—Ä—ã
3. **Fail2ban –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –∏–ª–∏ –±—ã–ª —Å–ª–∞–±–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω** - –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –∞—Ç–∞–∫–∏
4. **SSH –¥–æ—Å—Ç—É–ø –æ—Ç–∫—Ä—ã—Ç –≤—Å–µ–º IP** - –ª—é–±–æ–π –º–æ–∂–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –ø–æ–¥–æ–±—Ä–∞—Ç—å –ø–∞—Ä–æ–ª—å
5. **–°–∏—Å—Ç–µ–º–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª–∞—Å—å** - —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –≤ —Å—Ç–∞—Ä—ã—Ö –ø–∞–∫–µ—Ç–∞—Ö
6. **–ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞** - –º–∞–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–ª—Å—è, –Ω–æ –Ω–µ –±—ã–ª –æ–±–Ω–∞—Ä—É–∂–µ–Ω

### –ß—Ç–æ —Ç–µ–ø–µ—Ä—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

‚úÖ **–¢–æ–ª—å–∫–æ SSH –∫–ª—é—á–∏** - –ø–∞—Ä–æ–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç–∫–ª—é—á–µ–Ω—ã
‚úÖ **–°–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—Ç SSH** - –Ω–µ 22, –∞ –Ω–∞–ø—Ä–∏–º–µ—Ä 23456
‚úÖ **Whitelist IP** - SSH –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ —Å –≤–∞—à–µ–≥–æ IP
‚úÖ **–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π fail2ban** - –±–ª–æ–∫–∏—Ä—É–µ—Ç –ø–æ—Å–ª–µ 3 –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ 24 —á–∞—Å–∞
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
‚úÖ **–û—á–∏—Å—Ç–∫–∞ –∂—É—Ä–Ω–∞–ª–æ–≤** - –Ω–µ –∑–∞—Å–æ—Ä—è—é—Ç –¥–∏—Å–∫
‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã** - —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∑–∞–∫—Ä—ã—Ç—ã

### –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

```bash
# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–∞—Ä–æ–ª–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã
grep PasswordAuthentication /etc/ssh/sshd_config
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: PasswordAuthentication no

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ SSH –∫–ª—é—á–∏
grep PubkeyAuthentication /etc/ssh/sshd_config
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: PubkeyAuthentication yes

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ fail2ban
fail2ban-client status sshd
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ IP –µ—Å–ª–∏ –±—ã–ª–∏ –ø–æ–ø—ã—Ç–∫–∏

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall
ufw status
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑—Ä–µ—à—ë–Ω —Ç–æ–ª—å–∫–æ –≤–∞—à IP –Ω–∞ SSH –ø–æ—Ä—Ç

# 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
cat /var/log/security-check.log
# –õ–æ–≥–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

# 6. –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
ps aux | grep -E "(miner|crypto|xmrig)" | grep -v grep
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ!
```

### –ï—Å–ª–∏ –º–∞–π–Ω–µ—Ä —Å–Ω–æ–≤–∞ –ø–æ—è–≤–∏—Ç—Å—è:

1. **–°—Ä–∞–∑—É —É–±–µ–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å**: `ps aux | grep -E "(miner|crypto)"`
2. **–ù–∞–π–¥–∏—Ç–µ —Ñ–∞–π–ª**: `find / -name "*–ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–µ_–∏–º—è*"`
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫**: `crontab -l`, `systemctl list-units`
4. **–£–¥–∞–ª–∏—Ç–µ —Ñ–∞–π–ª –∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫**
5. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**: `/var/log/auth.log`, `/var/log/security-check.log`
6. **–ó–∞–±–ª–æ–∫–∏—Ä—É–π—Ç–µ IP** –≤ firewall –µ—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –∞—Ç–∞–∫—É

**–ì–ª–∞–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ:** –ë–µ–∑ SSH –∫–ª—é—á–µ–π + –±–µ–∑ whitelist IP = —Å–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –≤–∑–ª–æ–º–∞–Ω —Å–Ω–æ–≤–∞!

