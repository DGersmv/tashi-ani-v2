# üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å –∑–∞–≥—Ä—É–∑–∫–æ–π 3D –º–æ–¥–µ–ª–µ–π

## –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–û—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É Console
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥–µ–ª—å
   - –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –∫–∞–∫–∏–µ –æ—à–∏–±–∫–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è

2. **–°–µ—Ç–µ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É Network
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –º–æ–¥–µ–ª—å
   - –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∫ `/api/user/objects/[id]/models/[modelId]/view`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –æ—Ç–≤–µ—Ç–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 200)
   - –ï—Å–ª–∏ 404 - —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω
   - –ï—Å–ª–∏ 500 - –æ—à–∏–±–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

## –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ:

```bash
cd /var/www/tashi-ani

# 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PM2 –Ω–∞ –æ—à–∏–±–∫–∏
pm2 logs tashi-ani --err --lines 50 --nostream | grep -i "model\|bim\|ifc\|gltf"

# 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–æ–¥–µ–ª—å –µ—Å—Ç—å –≤ –ë–î
node -e "
const { PrismaClient } = require('@prisma/client');
const prisma = new PrismaClient();
(async () => {
  const models = await prisma.bimModel.findMany({
    select: {
      id: true,
      name: true,
      viewableFilename: true,
      viewableFilePath: true,
      viewableFormat: true,
      objectId: true
    }
  });
  console.log('–ú–æ–¥–µ–ª–∏ –≤ –ë–î:');
  console.log(JSON.stringify(models, null, 2));
  await prisma.\$disconnect();
})();
"

# 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ–∞–π–ª—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –Ω–∞ –¥–∏—Å–∫–µ
# –ó–∞–º–µ–Ω–∏—Ç–µ [objectId] –∏ [modelId] –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
ls -la /var/www/tashi-ani/public/uploads/objects/[objectId]/models/[modelId]/

# 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
find /var/www/tashi-ani/public/uploads/objects -name "*.ifc" -o -name "*.gltf" -o -name "*.glb" | head -10
```

## –®–∞–≥ 3: –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –§–∞–π–ª –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
**–°–∏–º–ø—Ç–æ–º—ã:** –û—à–∏–±–∫–∞ "–§–∞–π–ª –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω"
**–†–µ—à–µ–Ω–∏–µ:** 
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥–µ–ª–∏ –±—ã–ª –≤—ã–±—Ä–∞–Ω —Ñ–∞–π–ª –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ (IFC –∏–ª–∏ GLTF)
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ `viewableFilePath` –∏ `viewableFilename` –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤ –ë–î

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
**–°–∏–º–ø—Ç–æ–º—ã:** –û—à–∏–±–∫–∞ 404 "–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ø–æ –ø—É—Ç–∏ –∏–∑ `viewableFilePath`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –ø—É—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å `/uploads/...`)

### –ü—Ä–æ–±–ª–µ–º–∞ 3: CORS –æ—à–∏–±–∫–∏
**–°–∏–º–ø—Ç–æ–º—ã:** –û—à–∏–±–∫–∞ CORS –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ API route –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ `Access-Control-Allow-Origin` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ IFC
**–°–∏–º–ø—Ç–æ–º—ã:** –ú–æ–¥–µ–ª—å –Ω–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –ø—Ä–æ web-ifc
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ WASM —Ñ–∞–π–ª—ã –¥–æ—Å—Ç—É–ø–Ω—ã: `/wasm/web-ifc.wasm` –∏ `/wasm/web-ifc-mt.wasm`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏ WASM

### –ü—Ä–æ–±–ª–µ–º–∞ 5: –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ GLTF
**–°–∏–º–ø—Ç–æ–º—ã:** GLTF –º–æ–¥–µ–ª—å –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ model-viewer –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ–∞–π–ª GLTF/GLB –≤–∞–ª–∏–¥–Ω—ã–π
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

## –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ API route

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ API route —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
# –ó–∞–º–µ–Ω–∏—Ç–µ [objectId], [modelId] –∏ [email] –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
curl -I "http://127.0.0.1:3000/api/user/objects/[objectId]/models/[modelId]/view?email=[email]"

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å HTTP 200
# –ï—Å–ª–∏ 404 - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –º–æ–¥–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Ñ–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω
# –ï—Å–ª–∏ 500 - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ PM2
```

## –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç:

```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
// 1. –ß—Ç–æ –º–æ–¥–µ–ª—å –∏–º–µ–µ—Ç viewableFormat
console.log(model.viewableFormat); // –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 'IFC' –∏–ª–∏ 'GLTF'

// 2. –ß—Ç–æ –º–æ–¥–µ–ª—å –∏–º–µ–µ—Ç viewableFilePath
console.log(model.viewableFilePath); // –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É—Ç—å —Ç–∏–ø–∞ '/uploads/objects/1/models/1/viewable.ifc'

// 3. –ß—Ç–æ URL —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ
const url = `/api/user/objects/${objectId}/models/${model.id}/view?email=${userEmail}`;
console.log(url);
```

## –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å

1. **–ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞** - –∫–∞–∫–∏–µ –æ—à–∏–±–∫–∏?
2. **Network tab** - –∫–∞–∫–æ–π —Å—Ç–∞—Ç—É—Å —É –∑–∞–ø—Ä–æ—Å–∞ –∫ `/api/user/objects/[id]/models/[modelId]/view`?
3. **–õ–æ–≥–∏ PM2** - –µ—Å—Ç—å –ª–∏ –æ—à–∏–±–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ?
4. **–§–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç?** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ñ–∞–π–ª –µ—Å—Ç—å –Ω–∞ –¥–∏—Å–∫–µ –ø–æ –ø—É—Ç–∏ –∏–∑ –ë–î

–ü—Ä–∏—à–ª–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç—Ç–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–ª—è —Ç–æ—á–Ω–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.



